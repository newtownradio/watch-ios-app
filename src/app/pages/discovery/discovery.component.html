<div class="discovery-page">
  <div class="page-header">
    <h1>Discovery</h1>
    <p>Find your perfect timepiece</p>
  </div>

  <!-- Search and Filters -->
  <div class="search-section">
    <div class="search-bar">
      <div class="search-input-group">
        <input 
          type="text" 
          [(ngModel)]="searchTerm" 
          placeholder="Search watches, sellers..."
          class="search-input"
          id="search-input"
          (keyup.enter)="performSearch()"
        >
        <button class="search-btn" (click)="performSearch()" type="button">
          Search
        </button>
      </div>
    </div>

    <div class="filters">
      <div class="filter-row">
        <div class="price-range">
          <label for="min-price">Price Range:</label>
          <div class="price-inputs">
            <input 
              type="number" 
              [(ngModel)]="minPrice" 
              placeholder="Min"
              class="price-input"
              id="min-price"
            >
            <span>-</span>
            <input 
              type="number" 
              [(ngModel)]="maxPrice" 
              placeholder="Max"
              class="price-input"
              id="max-price"
            >
          </div>
        </div>

        <div class="brand-filter">
          <label for="brand-select">Brand:</label>
          <select [(ngModel)]="selectedBrand" id="brand-select" class="filter-select">
            <option value="">All Brands</option>
            <option *ngFor="let brand of getAvailableBrands()" [value]="brand">
              {{ brand }}
            </option>
          </select>
        </div>

        <div class="condition-filter">
          <label for="condition-select">Condition:</label>
          <select [(ngModel)]="selectedCondition" id="condition-select" class="filter-select">
            <option value="">All Conditions</option>
            <option *ngFor="let condition of getAvailableConditions()" [value]="condition">
              {{ condition }}
            </option>
          </select>
        </div>

        <div class="sort-filter">
          <label for="sort-select">Sort by:</label>
          <select [(ngModel)]="sortBy" id="sort-select" class="filter-select">
            <option value="newest">Newest First</option>
            <option value="oldest">Oldest First</option>
            <option value="price-low">Price: Low to High</option>
            <option value="price-high">Price: High to Low</option>
            <option value="ending-soon">Ending Soon</option>
            <option value="most-bids">Most Bids</option>
          </select>
        </div>
      </div>

      <div class="filter-row">
        <div class="favorites-filter">
          <label class="checkbox-label" for="favorites-only">
            <input 
              type="checkbox" 
              [(ngModel)]="showFavoritesOnly"
              class="checkbox"
              id="favorites-only"
            >
            <span>Favorites only</span>
          </label>
        </div>

        <div class="filter-buttons">
          <button class="search-filters-btn" (click)="performSearch()" type="button">
            Search
          </button>
          <button class="clear-btn" (click)="clearFilters()" type="button">
            Clear Filters
          </button>
        </div>
      </div>
    </div>
  </div>

  <!-- Place Bid Section -->
  <div class="place-bid-section">
    <div class="place-bid-header">
      <h2>Place Bids on Your Favorites</h2>
      <p>Quick bid on items you've favorited</p>
    </div>
    
    <div class="favorite-listings">
      <div class="favorite-card" *ngFor="let listing of getFavoriteListings()">
        <div class="favorite-image">
          <img [src]="listing.imageUrl || 'data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMjAwIiBoZWlnaHQ9IjIwMCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj48cmVjdCB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiBmaWxsPSIjZjBmMGYwIi8+PHRleHQgeD0iNTAlIiB5PSI1MCUiIGZvbnQtZmFtaWx5PSJBcmlhbCwgc2Fucy1zZXJpZiIgZm9udC1zaXplPSIxNCIgZmlsbD0iIzk5OSIgdGV4dC1hbmNob3I9Im1pZGRsZSIgZHk9Ii4zZW0iPldhdGNoPC90ZXh0Pjwvc3ZnPg=='" [alt]="listing.title">
        </div>
        <div class="favorite-info">
          <h3>{{ listing.title }}</h3>
          <p class="current-bid">Current Bid: ${{ listing.currentPrice.toLocaleString() }}</p>
          <p class="time-left">{{ getTimeRemaining(listing.endTime) }} left</p>
          <div class="favorite-actions">
            <button class="favorite-bid-btn" (click)="openBidForm(listing)" title="Place a bid">
              üí∞ Place Bid
            </button>
            <button class="favorite-share-btn" (click)="shareListing(listing)" title="Share this listing">
              üì§ Share
            </button>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Results Count -->
  <div class="results-info">
    <p>{{ filteredListings.length }} items found</p>
  </div>

  <!-- Listings Grid -->
  <div class="products-grid">
    <div class="product-card" *ngFor="let listing of filteredListings">
      <div class="product-image">
        <img [src]="listing.imageUrl || 'data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMjAwIiBoZWlnaHQ9IjIwMCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj48cmVjdCB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiBmaWxsPSIjZjBmMGYwIi8+PHRleHQgeD0iNTAlIiB5PSI1MCUiIGZvbnQtZmFtaWx5PSJBcmlhbCwgc2Fucy1zZXJpZiIgZm9udC1zaXplPSIxNCIgZmlsbD0iIzk5OSIgdGV4dC1hbmNob3I9Im1pZGRsZSIgZHk9Ii4zZW0iPldhdGNoPC90ZXh0Pjwvc3ZnPg=='" [alt]="listing.title">
        <button class="favorite-btn" (click)="toggleFavorite(listing.id)">
          {{ isFavorited(listing.id) ? '‚ù§Ô∏è' : 'ü§ç' }}
        </button>
      </div>
      <div class="product-info">
        <h3>{{ listing.title }}</h3>
        <p class="price">${{ listing.currentPrice.toLocaleString() }}</p>
        <p class="description">{{ listing.description }}</p>
        <div class="watch-details" *ngIf="listing.brand || listing.model">
          <span class="brand-model" *ngIf="listing.brand && listing.model">
            {{ listing.brand }} {{ listing.model }}
          </span>
          <span class="condition" *ngIf="listing.condition">
            Condition: {{ listing.condition }}
          </span>
        </div>
        <div class="seller">
          <span>{{ listing.sellerName }}</span>
          <span>‚≠ê 4.8</span>
        </div>
        <div class="listing-details">
          <span class="time-remaining">
            {{ getTimeRemaining(listing.endTime) }} left
          </span>
          <span class="bids-count" *ngIf="listing.bids.length > 0">
            {{ listing.bids.length }} bid{{ listing.bids.length > 1 ? 's' : '' }}
          </span>
        </div>
        <div class="listing-times">
          <span class="posted-time">
            Posted: {{ getListingStartTime(listing.createdAt) }}
          </span>
          <span class="ends-time">
            Ends: {{ getListingEndTime(listing.endTime) }}
          </span>
        </div>
        <div class="listing-actions">
          <button class="bid-btn" (click)="openBidForm(listing)" title="Place a bid">
            üí∞ Place Bid
          </button>
          <button class="share-btn" (click)="shareListing(listing)" title="Share this listing">
            üì§ Share
          </button>
        </div>
      </div>
    </div>
  </div>

  <!-- No Results Message -->
  <div class="no-results" *ngIf="filteredListings.length === 0">
    <p>No listings found matching your criteria</p>
    <button class="clear-btn" (click)="clearFilters()">Clear Filters</button>
  </div>

  <!-- Bid Form Section (replaces modal) -->
  <div class="bid-form-section" *ngIf="showBidForm && selectedListing">
    <div class="bid-form-container">
      <div class="bid-form-header">
        <h3>Place Bid on {{ selectedListing.title }}</h3>
        <button class="close-btn" (click)="closeBidForm()">‚úï</button>
      </div>
      <app-bid-form 
        [listing]="selectedListing"
        (bidPlaced)="onBidPlaced($event)"
        (cancelled)="closeBidForm()"
      ></app-bid-form>
    </div>
  </div>
</div>